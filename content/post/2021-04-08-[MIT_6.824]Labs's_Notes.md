---
title: "[PaperNotes]2017.Algorand: Scaling byzantine agreements for cryptocurrencies"
date: 2021-04-08T20:47:09+08:00
draft: false

toc: true
categories: [Notes]
tags: [MIT 6.824, Distributed System]
keywords: []
description: ""
---


> MIT 6.824-2020/2021
>
> 记录MIT 6.824 labs中遇到的问题与分析
>
> 拖延症要不得，加油！网上有挺多做完的，得自己做一遍才知道如何
>
> 实验源码地址：https://github.com/fzhiy/MIT-6.824

# [Lab 1: MapReduce](http://nil.csail.mit.edu/6.824/2020/labs/lab-mr.html)

```bash
go build -buildmode=plugin ../mrapps/wc.go #以插件开发方式编译wc.go代码
rm mr-out* #先删除当前的mr的输出文件，如mrsequential.go运行后生成的mr-out-0文件
go run mrsequential.go wc.so pg*.txt #wc.go（plugin file，动态库）是mrsequential.go的loadPlugin的参数 用于加载MapReduce函数
```

## 具体工作

你的工作是实现一个分布式的MapReduce，包括两个程序，master 和 worker。只有**一个master进程** 以及 **一个或多个worker进程并行执行**。在真实的系统中，工作人员将在许多不同的机器上运行，但在本实验室中，您将在**一台机器上**运行所有的worker。worker将通过RPC与master通信。每个worker进程将向master请求任务，从一个或多个文件读取任务的输入，执行任务，并将任务的输出写入一个或多个文件。如果一个worker没有在合理的时间内完成任务(对于这个实验室，使用10秒)，master应该注意，并把同样的任务交给另一个worker。

开始已经给了一些代码。main/mrmaster.go和main/mrworker.go分别是master和worker 的主例程，不要修改这些代码。

应该在**mr/master.go、mr/worker.go和mr/rpc.go**中给出实现。

下面是如何在单词计数MapReduce应用程序上运行代码。首先，确保word-count插件是新构建的:

```bash
go build -buildmode=plugin ../mrapps/wc.go
## 在main目录 run master
rm mr-out*
go run mrmaster.go pg-*.txt #pg-*.txt是mrmaster.go的参数作为input files；每个文件对应一个split 是一个Map任务的输入

```

> 任务解读（来源：https://zhuanlan.zhihu.com/p/260752052）
>
> 测试时，启动一个`master`和多个`worker`，也就是运行一次`mrmaster.go`、运行多次`mrworker.go`。
>
> `master`进程启动一个`rpc`服务器，每个`worker`进程通过`rpc`机制向`Master`要任务。任务可能包括`map`和`reduce`过程，具体如何给`worker`分配取决于`master`。
>
> 每个单词和它出现的次数以`key-value`**键值对**形式出现。`map`进程将每个出现的单词机械地分离出来，并给每一次出现标记为1次。很多单词在电子书中重复出现，也就产生了很多相同**键值对**。还没有对键值对进行合并，故此时产生的键值对的**值**都是1。此过程在下图中`mapper`伸出箭头表示。
>
> 已经分离出的单词以键值对形式分配给特定`reduce`进程，`reduce`进程个数远小于单词个数，每个`reduce`进程都处理一定量单词。相同的单词应由相同的`reduce`进程处理。处理的方式和上面描述的算法类似，对单词排序，令单词在数组中处在相邻位置，再统计单词个数。最终，每个`reduce`进程都有一个输出，合并这些输出，就是`Word Count`结果。此过程在下图中箭头进入`reducer`、以及后面的合并表示。
>
> 
>
> ![img](https://pic4.zhimg.com/80/v2-1e1f9431d6bd05ff0efe3281628e79db_720w.jpg)
>
> <center> MapReduce WordCount
> </center>
>
>
> 图中，相同的单词由相同`reducer`处理。如第一个`reducer`接受单词`A, B`，最后一个`reducer`接受单词`C`。
>
> 测试流程要求，输出的文件个数和参数`nReduce`相同，即每个输出文件对应一个`reduce`任务，格式和`mrsequential`的输出格式相同，命名为`mr-out*`。我们的代码应保留这些文件，不做进一步合并，测试脚本将进行这一合并。合并之后的最终完整输出，必须和`mrsequential`的输出完全相同。
>
> 查看测试脚本`test-mr.sh`，可以看到合并每个输出`mr-out*`的指令如下，将每个输出文件的每一行按行首单词排序，输出到最终文件`mr-wc-all`中。
>
> ```shell
> sort mr-out* | grep . > mr-wc-all
> ```
>
> 故每个`reduce`任务不能操作相同的单词，在`map`流程中分离出的相同单词**键值对**应由同一个`reduce`流程处理。

Lab1实验关键函数与流程。（参考：https://zhuanlan.zhihu.com/p/260752052）

![](https://img.fzhiy.net/img/lab1_MapReduce.png)

进入src/main目录，执行./test-mr.sh > ./test-mr.out

test-mr.out中出现“PASSED ALL TESTS” 则说明通过全部测试。

![](https://img.fzhiy.net/img/20210413183810.png)

## 00.环境按照教材来

## 01.go编译wc.go报错

编译代码：go build -buildmode=plugin ../mrapps/wc.go

错误如下：

![](https://img.fzhiy.net/img/image-20210408203831908.png)

解决方法（[来源-> 用户Superman2077](https://learnku.com/go/t/41396)）

![](https://img.fzhiy.net/img/image-20210408203735931.png)

实测：

![](https://img.fzhiy.net/img/image-20210408204024501.png)



# [Lab 2: Raft](http://nil.csail.mit.edu/6.824/2020/labs/lab-raft.html)





# [Lab 3: KV Raft](http://nil.csail.mit.edu/6.824/2020/labs/lab-kvraft.html)



# [Final Project](http://nil.csail.mit.edu/6.824/2020/project.html)



# [Lab 4: Sharded KV](http://nil.csail.mit.edu/6.824/2020/labs/lab-shard.html)







# 参考资料

- [MIT 6.824-2020] (http://nil.csail.mit.edu/6.824/2020/schedule.html)
- [MIT 6.824课程笔记] (https://mit-public-courses-cn-translatio.gitbook.io/mit6-824/)
- MIT 6.824 labs ：https://zhuanlan.zhihu.com/p/260752052

